define("kg/mini-login/6.3.12/index",["node","dom","event","cookie","util","ua","io"],function(i,t,e){var n,o=i("node"),s=i("dom"),l=i("event"),c=i("cookie"),r=i("util"),a=i("ua"),h=i("io");n=function(i){function t(i){return this instanceof t?(this.cfg=g.merge(J,i||{}),this.guid=g.guid(),this.type=this.cfg.type,this.sub=this.cfg.sub,this.zindex=this.cfg.zindex,this.cfg.checkPath&&(this.checkPath=this.cfg.checkPath),this.cfg.guid=this.guid,this.cfg.ifrwidth=this.cfg.width,this.cfg.ifrheight=this.cfg.height-40,this.cfg.url=this.cfg.loginURL||L+window.encodeURIComponent(this.cfg.directURL||z)+(this.cfg.sub?"&sub=true":""),this.cfg.zindex=this.zindex,this.cfg.checkOfAsync=this.cfg.checkOfAsync||S,void this._init()):new t(i)}var e=o,n=s,d=l,f=c,g=r,u=a,p=h,m="https:"===location.protocol?"https:":"http:",b=g.unparam(location.search.slice(1))._login_daily_,_=b||-1!==location.host.indexOf(".daily."),w=_?"//g-assets.daily.taobao.net/":"//g.alicdn.com/",k=6===u.ie,x=!1;try{x=!!window.navigator.userAgent.match(/WindVane/i)}catch(v){}var y="1.4.6",C=_?"daily.taobao.net":"taobao.com",H=m+"//buy."+C+"/auction/buy.htm?from=tbcminilogin?_minilogin_t_={t}",z=m+"//www.taobao.com/go/act/loginsuccess/taobao.php",L="https://login."+C+"/member/login.jhtml?style=mini&newMini2=true&is_ignore=false&redirect_url=",I="https://login."+C+"/member/login.jhtml?redirect_url="+window.encodeURIComponent(location.href),T="http://login.m.taobao.com/login.htm?tpl_redirect_url="+encodeURIComponent(location.href),O=".#{prefixCls}mini-login{display:none;width:#{width}px;height:#{height}px;opacity:1;color:#404040;position:fixed;_position:absolute;z-index:#{zindex};}.#{prefixCls}mnl-bg{position:absolute;z-index:0;width:100%;height:100%;border:5px solid #999;left:-5px;top:-5px;opacity:0.2;}.#{prefixCls}mnl-box{position:relative;z-index:1;background:#fff;}.#{prefixCls}mnl-hd{height:40px;line-height:40px;padding-right:14px;font-family:Arial,Helvetica,sans-serif;font-weight:700;font-size:14px;color:#fff;text-align:right;background-color:#f40;}.#{prefixCls}mnl-ifr{display:block;width:#{ifrwidth}px;height:#{ifrheight}px;margin:0 auto;}.#{prefixCls}mnl-ft{background-color:#F5F5F5;}.#{prefixCls}mnl-close{display:block;width:24px;height:24px;text-align:center;line-height:24px;color:#fff;font-family:Tahoma,sans;font-size:22px;position:absolute;text-decoration:none;top:8px;left:5px;opacity:0.8}.#{prefixCls}mnl-close:hover{opacity:1;border-radius:12px;background:#FFF;color:#f40;text-decoration:none;}",M='<div id="J_MiniLogin_{guid}" class="{prefixCls}mini-login J_TbMiniLogin"><div class="{prefixCls}mnl-bg"></div><div class="{prefixCls}mnl-box"><div class="{prefixCls}mnl-hd">{title}</div><div class="{prefixCls}mnl-bd"><iframe class="{prefixCls}mnl-ifr" scrolling="no" frameborder="no" id="J_MiniLoginIfr_{guid}" src="{url}"></iframe></div><div class="{prefixCls}mnl-ft"><a class="{prefixCls}mnl-close" id="J_MiniLoginClose_{guid}" target="_self" title="\u5173\u95ed\u6b64\u7a97\u53e3" href="javascript:void(0)">\xd7</a></div></div></div>',S=function(i){var t,e=!1;return i&&g.isObject(i)||(t=new Error("checkPath error")),i.success&&i.login&&(e=!0),{error:t,isLogin:e,data:i}},j=window.goldlog||{record:function(){}};j.record("/minilogin.10.1","","","H46866756");var A=window.g_config?g_config.loginCfg:{},J=g.merge({width:350,height:478,title:"\u8d26\u6237\u767b\u5f55",type:"m",sub:0,zindex:1e8},A||{}),B=[];return g.augment(t,d.Target,{_init:function(){try{this.nick=TB.Global.util.getNick()}catch(i){}j.record("/minilogin.10.2","","","H46866778")},_create:function(){var i=g.substitute(O,this.cfg,/#\{([^{}]+)\}/g),t=g.substitute(M,this.cfg);try{n.addStyleSheet(i)}catch(o){}this.el=e.one(n.create(t)),n.append(this.el,document.body),this.ifr=e.one("#J_MiniLoginIfr_"+this.guid),this._bind()},_bind:function(){var i=this;e.all("#J_MiniLoginClose_"+this.guid).on("click",function(t){t.halt(),i.hide(!1)}),this.ifr.on("load",function(t){var e=i.ifr.attr("src");if("about:blank"!==e)return i.ifr.data("inited")?0===e.indexOf(z)?void i._successHandle():0===e.indexOf(L)||0===e.indexOf(i.cfg.loginURL)?void i._checkAndShow(!0):void 0:void i.ifr.data("inited",1)})},_pos:function(){var i,t,e=this.cfg.position;g.isObject(e)?(i=e.left||0,t=e.top||0):(i=parseInt(n.viewportWidth()/2,10)-parseInt(this.el[0].offsetWidth/2,10)+"px",t=(k?n.scrollTop():0)+parseInt(n.viewportHeight()/2,10)-parseInt(this.el[0].offsetHeight/2,10)+"px"),this.el.css({top:t,left:i})},_errorHandle:function(){window.top.location.href=x?T:I,j.record("/minilogin.10.11","","","H46896547")},_successHandle:function(i){var t=this;this.callbacked||(this.callbacked=!0,this.hide(!0),this.fire("login",{showed:!i}),g.each(B,function(i){i.fire("anylogin"),i.guid!=t.guid&&i.fire("otherlogin")}),this.callback&&this.callback(),this.callback=null,this._refreshGlobal(),j.record("/minilogin.10.10","","","H46896546"))},_refreshGlobal:function(){try{var i=TB.Global.util.getNick();if(i===this.nick)return;TB.Global.reload(),this.nick=i}catch(t){}},_localCheck:function(i){var t=f.get("_l_g_"),e=f.get("lgc"),n=f.get("tracknick");return"l"===this.type?void i(!!e):(i(null,t&&n),void j.record("/minilogin.10.6","","","H46866782"))},_asyncCheck:function(i){var t=this;if(t.checkPath)new p({url:t.checkPath,type:"get",dataType:"json",timeout:5,data:{t:g.now()},error:function(i,e,n){t.fire("error",{status:e})},complete:function(e){var n=t.cfg.checkOfAsync(e);i(n.error,n.isLogin,n.data)}});else{var e=H;e=g.substitute(e,{t:g.now()}),p.getScript(e,function(){return window.loginIndicator&&g.isObject(window.loginIndicator)?void(window.loginIndicator.hasLoggedIn?i(null,!0):i(null,!1)):(i(new Error("ErrCheckByBuy")),void j.record("/minilogin.10.9","","","H46866785"))})}j.record("/minilogin.10.7","","","H46866783")},check:function(i){"l"===this.type?this._localCheck(i):this._asyncCheck(i),j.record("/minilogin.10.5","","","H46866781")},_windVaneShow:function(){var i=this;p.getScript(w+"mtb/lib-windvane/"+y+"/windvane.js",function(){try{WindVane.call("TBHDCommon","login",{},function(t){i._successHandle()},function(t){i._errorHandle()})}catch(t){i._errorHandle()}})},_show:function(){return x?void this._windVaneShow():(this.el||this._create(),this.ifr.attr("src",this.cfg.url),e.all(".J_TbMiniLogin").hide(),e.all("iframe",".J_TbMiniLogin").data("inited",0),this.el.show(),this._pos(),this.showed=!0,void e.one(window).on(k?"scroll resize":"resize",this._pos,this))},_checkAndShow:function(i){var t=this;this.check(function(e,n){if(e)return void t._errorHandle();if(n===!0)t._successHandle(i?!1:!0);else{if(t.ifr&&1===t.ifr.data("inited"))return;t._show()}})},show:function(i){this.callback=i,this._checkAndShow(),j.record("/minilogin.10.3","","","H46866779")},hide:function(i){this.callbacked=!1,j.record("/minilogin.10.4","","","H46866780"),this.el&&this.showed&&(this.el.hide(),this.showed=!1,this.callback=null,this.ifr.attr("src","about:blank"),this.ifr.data("inited",0),i?this.fire("hide"):this.fire("close"),e.one(window).detach(k?"scroll resize":"resize",this._pos,this))}}),i=t}(),e.exports=n});